---
import { siteConfig, getWhatsAppUrl } from '../data/site';
---

<header class="sticky top-0 z-50 w-full border-b border-gray-200 dark:border-gray-800 bg-white/90 dark:bg-background-dark/90 backdrop-blur-md transition-colors duration-300">
  <div class="px-4 md:px-10 lg:px-40 py-3 flex items-center justify-between max-w-[1440px] mx-auto">
    <!-- Logo -->
    <div class="flex items-center gap-4">
      <div class="size-8 text-primary flex items-center justify-center rounded-lg bg-primary/10">
        <span class="material-symbols-outlined text-2xl">directions_car</span>
      </div>
      <h2 class="text-xl font-bold tracking-tight text-text-primary dark:text-white">{siteConfig.name}</h2>
    </div>
    
    <!-- Desktop Navigation -->
    <nav class="hidden md:flex flex-1 justify-end gap-6 items-center">
      <div class="flex items-center gap-6">
        {siteConfig.navLinks.map((link) => (
          <a 
            href={link.href} 
            class="text-sm font-medium hover:text-primary transition-colors text-text-primary dark:text-gray-300"
          >
            {link.label}
          </a>
        ))}
      </div>
      
      <!-- Dark Mode Toggle -->
      <button 
        id="theme-toggle" 
        class="p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
        aria-label="Toggle dark mode"
      >
        <span id="theme-icon-light" class="material-symbols-outlined text-xl text-gray-600 dark:hidden">light_mode</span>
        <span id="theme-icon-dark" class="material-symbols-outlined text-xl text-yellow-400 hidden dark:block">dark_mode</span>
      </button>
      
      <a 
        href="#kontak"
        class="flex cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-5 bg-primary hover:bg-primary-dark transition-colors text-white text-sm font-bold shadow-sm shadow-primary/20"
      >
        <span class="truncate">Hubungi Kami</span>
      </a>
    </nav>
    
    <!-- Mobile Right Section -->
    <div class="flex items-center gap-2 md:hidden">
      <!-- Mobile Dark Mode Toggle -->
      <button 
        id="theme-toggle-mobile" 
        class="p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
        aria-label="Toggle dark mode"
      >
        <span class="material-symbols-outlined text-xl text-gray-600 dark:text-yellow-400 theme-icon-mobile">light_mode</span>
      </button>
      
      <!-- Mobile Menu Button -->
      <button id="mobile-menu-btn" class="p-2 text-gray-600 dark:text-gray-300" aria-label="Toggle menu">
        <span class="material-symbols-outlined">menu</span>
      </button>
    </div>
  </div>
  
  <!-- Mobile Menu -->
  <div id="mobile-menu" class="hidden md:hidden bg-white dark:bg-background-dark border-t border-gray-200 dark:border-gray-800 px-4 py-4 transition-colors duration-300">
    {siteConfig.navLinks.map((link) => (
      <a 
        href={link.href} 
        class="block py-3 text-text-primary dark:text-gray-300 hover:text-primary transition-colors font-medium"
      >
        {link.label}
      </a>
    ))}
    <a
      href="#kontak"
      class="block mt-4 bg-primary hover:bg-primary-dark text-white text-center px-4 py-3 rounded-lg font-bold transition-colors"
    >
      Hubungi Kami
    </a>
  </div>
</header>

<script>
  // Theme toggle functionality
  function initTheme() {
    const html = document.documentElement;
    const themeToggle = document.getElementById('theme-toggle');
    const themeToggleMobile = document.getElementById('theme-toggle-mobile');
    const mobileIcons = document.querySelectorAll('.theme-icon-mobile');
    
    // Check for saved theme preference or default to system preference
    const savedTheme = localStorage.getItem('theme');
    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {
      html.classList.add('dark');
      updateMobileIcons(true);
    } else {
      html.classList.remove('dark');
      updateMobileIcons(false);
    }
    
    function updateMobileIcons(isDark: boolean) {
      mobileIcons.forEach(icon => {
        if (icon instanceof HTMLElement) {
          icon.textContent = isDark ? 'dark_mode' : 'light_mode';
        }
      });
    }
    
    function toggleTheme() {
      const isDark = html.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      updateMobileIcons(isDark);
      
      // Add transition class temporarily for smooth transition
      document.body.classList.add('theme-transition');
      setTimeout(() => {
        document.body.classList.remove('theme-transition');
      }, 300);
    }
    
    themeToggle?.addEventListener('click', toggleTheme);
    themeToggleMobile?.addEventListener('click', toggleTheme);
    
    // Listen for system theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      if (!localStorage.getItem('theme')) {
        if (e.matches) {
          html.classList.add('dark');
          updateMobileIcons(true);
        } else {
          html.classList.remove('dark');
          updateMobileIcons(false);
        }
      }
    });
  }
  
  // Mobile menu functionality
  function initMobileMenu() {
    const btn = document.getElementById('mobile-menu-btn');
    const menu = document.getElementById('mobile-menu');
    const icon = btn?.querySelector('.material-symbols-outlined');
    
    btn?.addEventListener('click', () => {
      menu?.classList.toggle('hidden');
      if (icon) {
        icon.textContent = menu?.classList.contains('hidden') ? 'menu' : 'close';
      }
    });
    
    // Close menu when clicking on a link
    menu?.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        menu?.classList.add('hidden');
        if (icon) icon.textContent = 'menu';
      });
    });
  }
  
  // Initialize on page load
  initTheme();
  initMobileMenu();
</script>
